<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <title>Cadastro de Usuario</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style type="text/css">
    
	    html {
		   margin-left : 5% ;
		   margin-right: 5% ;
		}
    
    </style>
  </head>
  <body>
    <h1> Cadastro de Usuário </h1>
    
    <form action="" id="formCadastroUsuario">
	  <div class="mb-3 row g-1">
	    <label for="id" class="form-label">Id</label>
	    <input type="text" class="form-control" id="id" readonly="true">
	    
	  </div>
	  <div class="mb-3">
	    <label for="nome" class="form-label">Nome do Usuário</label>
	    <input type="text" class="form-control" id="nome" required>	    
	  </div>
	  <button type="button" class="btn btn-primary" onclick="salvarUsuario()">Salvar</button>
	  <button type="button" class="btn btn-secondary" onclick="document.getElementById('formCadastroUsuario').reset()">Novo</button>
	  <button type="button" class="btn btn-info" data-bs-toggle="modal" data-bs-target="#modalPesquisarUsuario" onclick="">Pesquisar</button>
	  <button type="button" class="btn btn-danger" data-bs-toggle="modal" onclick="deleteUsuarioTela()">Apagar</button>
  </form >
    
  <div class="modal fade" id="modalPesquisarUsuario" tabindex="-1" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
	        <h5 class="modal-title" id="ModalLabel">Pesquisa Usuário</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="mb-3">
            <label for="nomeBusca" class="col-form-label">Informe o nome:</label>
            <input type="text" class="form-control" id="nomeBusca">
          </div>
          <button type="button" class="btn btn-success" onclick="pesquisaUsuario()">Buscar</button>
        </form>
        <div style="height: 300px; overflow:scroll;">
	        <table class="table" id="tabelaUsuarios">
			  <thead>
			    <tr>
			      <th scope="col">Id</th>
			      <th scope="col">Nome</th>
			      <th scope="col">Editar</th>
			      <th scope="col">Excluir</th>
			    
			    </tr>
			  </thead>
			  <tbody>
			  </tbody>
			</table>
	      </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        
      </div>
    </div>
  </div>
</div>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
 	
 	<script type="text/javascript">
 	   function deleteUsuarioTela(){
	      //
	       var id=$('#id').val();
	      if (id != null && id.trim() != ''){
			// Aciona a função para deletar do banco 
		      deleteUsuario( id) ;
		      // limpa a tela
		      document.getElementById('formCadastroUsuario').reset();
		  }
	     
	      
	      
	
       }
       /* Deleta o registro do Banco de dados */
 	   function deleteUsuario( id ){
	
		  if ( confirm('Deseja realmente deletar?')) {
			
			   $.ajax({
					method: "DELETE",
					url: "delete-usuario",
					data: "id="+id,
					success : function( response ){	
						$('#'+id).remove();
						alert( response ) ;
						//Fecha o modal
						//$('#modalPesquisarUsuario').modal('hide');
						
					}
				}).fail(function(xhr, status, errorThrown){
						alert("Erro ao pequisar usuário por id: "+xhr.responseText);
			   	});
		   	}
		
	   }
	   
 	   function emEdicao(id){
	      $.ajax({
					method: "GET",
					url: "buscar-usuario",
					data: "id="+id,
					success : function( response ){	
						// carrega os dados na tela					
						$("#id").val(response.id );
						$("#nome").val(response.nome );
						//Fecha o modal
						$('#modalPesquisarUsuario').modal('hide');
					}
				}).fail(function(xhr, status, errorThrown){
						alert("Erro ao pequisar usuário por id: "+xhr.responseText);
			   	});
       }
 	
 	   function pesquisaUsuario(){
	
	      var nome=$("#nomeBusca").val();
	     
	      if (nome != null && nome.trim() !=''){

			$.ajax({
					method: "GET",
					url: "buscarPorNome",
					data: "nome="+nome,
					success : function( response ){
						
											
						$('#tabelaUsuarios > tbody > tr').remove();
						
						for (var i= 0; i < response.length; i++){
							
							$('#tabelaUsuarios > tbody').append('<tr id="'+response[i].id+'"><td>'+response[i].id+'</td><td>'+response[i].nome+'</td><td><button type="button" class="btn btn-primary" onclick="emEdicao('+response[i].id+')">Editar</button></td> <td><button type="button" class="btn btn-danger" onclick="deleteUsuario('+response[i].id+')">Excluir</button></td></tr>');
						}
						
						
						
					}
				}).fail(function(xhr, status, errorThrown){
						alert("Erro ao pequisar usuário: "+xhr.responseText);
			   	});
		  }
	
	   }
 	
       function salvarUsuario(){
	      
		    var id=$("#id").val();
		    var nome=$("#nome").val();
		    
		    if (nome == null || nome != null && nome.trim() =='' ){
			   $("#nome").focus();
			   alert('Informe o nome.') ;
			   return;
			}
			$.ajax({
				method: "POST",
				url: "salvar-usuario",
				data: JSON.stringify({ id : id, nome: nome}),
				contentType: "application/json; charset-utf-8",
				success : function( response ){
					$("#id").val(response.id );
					
					alert("Gravou com sucesso!")
				}
			}).fail(function(xhr, status, errorThrown){
					alert("Erro ao salvar usuário: "+xhr.responseText);
		   	});
	   }
    </script>
  </body>
</html>